name: Proxy Secrets Smoke Test

on:
  workflow_dispatch: {}

jobs:
  check-proxy-secrets:
    runs-on: ubuntu-latest
    env:
      PROXY_API_KEY: ${{ secrets.PROXY_API_KEY }}
      PROXY_BASE_URL: ${{ secrets.PROXY_BASE_URL }}
    steps:
      - name: 🧾 Check runner environment
        run: |
          echo "Python version:"
          python3 --version
          echo "GitHub runner ready."

      - name: 🔍 Verify secrets presence
        run: |
          set -e
          if [ -z "$PROXY_API_KEY" ]; then
            echo "❌ PROXY_API_KEY missing" >&2
            exit 1
          fi
          if [ -z "$PROXY_BASE_URL" ]; then
            echo "❌ PROXY_BASE_URL missing" >&2
            exit 1
          fi
          echo "✅ Both secrets are present."

      - name: 🧪 Safe test with masking
        run: |
          echo "PROXY_API_KEY (masked) = ${PROXY_API_KEY}"
          echo "Length of PROXY_API_KEY = ${#PROXY_API_KEY}"
          echo "PROXY_BASE_URL = ${PROXY_BASE_URL}"
          python3 - << 'PY'
          import os
          key = os.getenv("PROXY_API_KEY")
          url = os.getenv("PROXY_BASE_URL")
          assert key, "PROXY_API_KEY missing"
          assert url, "PROXY_BASE_URL missing"
          print(f"Python can access both secrets ✅ (key len={len(key)}, base={url})")
          PY
